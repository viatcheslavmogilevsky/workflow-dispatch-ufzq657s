name: Fake staging deploy

on:
  workflow_dispatch:
    inputs:
      override_user:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Echo context
      id: echo_context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: 'echo "Hello, this is context: $GITHUB_CONTEXT"'
    - name: Checkout code
      id: code_checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ github.ref_name }}
        fetch-depth: 5
        fetch-tags: true
    - name: Push staging git tag
      id: tag_push
      env:
        ALL_INPUTS: ${{ toJson(inputs) }}
      run: |
        EXPORTED_INPUTS="$(jq -jc <<<$ALL_INPUTS)"
        git config --global user.name '${{ inputs.override_user || github.actor }}'
        git config --global user.email '${{ inputs.override_user || github.actor }}@users.noreply.github.com'
        git tag --annotate --force --message " ${EXPORTED_INPUTS}" staging_release
        git push --force --tags
